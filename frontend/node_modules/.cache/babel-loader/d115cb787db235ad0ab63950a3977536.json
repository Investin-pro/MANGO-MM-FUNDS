{"ast":null,"code":"var _jsxFileName = \"/Users/zohebshahzan/code/Solana-2/frontend/src/components/MangoPlaceOrder.js\",\n    _s = $RefreshSig$();\n\nimport { PublicKey, Transaction, TransactionInstruction } from '@solana/web3.js';\nimport React, { useState } from 'react';\nimport { GlobalState } from '../store/globalState';\nimport { adminAccount, connection, FUND_ACCOUNT_KEY, programId, TOKEN_PROGRAM_ID, MANGO_GROUP_ACCOUNT, SOL_USDC_MARKET, SYSTEM_PROGRAM_ID, idsIndex, MARGIN_ACCOUNT_KEY_1, PERP_ACCOUNT_KEY_1, MANGO_PROGRAM_ID, MANGO_TOKENS, PERP_MARKETS, platformStateAccount } from '../utils/constants';\nimport { nu64, struct, u8, u32, ns64 } from 'buffer-layout';\nimport { createKeyIfNotExists, findAssociatedTokenAddress, setWalletTransaction, signAndSendTransaction, createAssociatedTokenAccountIfNotExist } from '../utils/web3';\nimport { FUND_DATA, FUND_PDA_DATA, INVESTOR_DATA, PLATFORM_DATA } from '../utils/programLayouts';\nimport { MarginAccountLayout, selfTradeBehaviorLayout } from '../utils/MangoLayout';\nimport { devnet_pools, pools } from '../utils/pools';\nimport { updatePoolPrices } from './updatePrices';\nimport { mangoClosePosition, mangoOpenPosition } from '../utils/mango';\nimport BN from 'bn.js';\nimport { IDS, MangoAccountLayout, MangoClient, NodeBankLayout, perpAccountLayout, PerpMarketLayout, u64 } from '@blockworks-foundation/mango-client';\nimport { OpenOrders } from '@project-serum/serum';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const MangoPlaceOrder = () => {\n  _s();\n\n  const walletProvider = GlobalState.useState(s => s.walletProvider);\n  const ids = IDS['groups'][idsIndex];\n  const [size, setSize] = useState(0);\n  const [price, setPrice] = useState(0);\n  const [lendAmount, setLendAmount] = useState(0);\n  const [orderPerpIndex, setOrderPerpIndex] = useState(0);\n  const [addRemovePerpIndex, setAddRemovePerpIndex] = useState(0);\n  const [addRemoveTokenIndex, setAddRemoveTokenIndex] = useState(0);\n  const [lendTokenIndex, setLendTokenIndex] = useState(0);\n  const [side, setSide] = useState(0);\n\n  const handleMangoOpenOrders = async () => {\n    const key = walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey;\n\n    if (!key) {\n      alert(\"connect wallet\");\n      return;\n    }\n\n    ;\n    const transaction = new Transaction();\n    const fundStateAccount = await PublicKey.createWithSeed(key, FUND_ACCOUNT_KEY, programId);\n    console.log(\"FUND STTE:: \", fundStateAccount.toBase58());\n    let fund_info = await connection.getAccountInfo(fundStateAccount);\n    const fund_data = FUND_DATA.decode(fund_info.data);\n    let pos_index = fund_data.no_of_margin_positions;\n    console.log(\"pos_index\", pos_index);\n    console.log(\"orderPerpIndex:: \", orderPerpIndex);\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId));\n    let mangoGroup = await client.getMangoGroup(connection, MANGO_GROUP_ACCOUNT); // open orders missing for this market; create a new one now\n\n    const openOrdersSpace = OpenOrders.getLayout(mangoGroup.dexProgramId).span;\n    const openOrdersLamports = await connection.getMinimumBalanceForRentExemption(openOrdersSpace, 'singleGossip');\n    let accInstr = await createKeyIfNotExists(walletProvider, \"\", mangoGroup.dexProgramId, key.toBase58().substr(0, 20) + pos_index.toString() + orderPerpIndex.toString(), openOrdersSpace, transaction);\n    transaction.feePayer = key;\n    let hash = await connection.getRecentBlockhash();\n    console.log(\"blockhash\", hash);\n    transaction.recentBlockhash = hash.blockhash;\n    const sign = await signAndSendTransaction(walletProvider, transaction);\n    console.log(\"signature tx:: \", sign);\n    console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`);\n  };\n\n  const handlePerpMarketOrder = async () => {\n    console.log(\"---** handleAddPerpMarketselected orderPerpIndex, size, side :\", orderPerpIndex, size, side);\n    const key = walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey;\n\n    if (!key) {\n      alert(\"connect wallet\");\n      return;\n    }\n\n    ;\n    const transaction = new Transaction(); // const perpAccount = await createKeyIfNotExists(walletProvider, \"\", MANGO_PROGRAM_ID, PERP_ACCOUNT_KEY_1, perpAccountLayout.span, transaction)\n    // console.log(\"mangoAccount created::\",perpAccount.toBase58())\n    // const mango_token_index = \n\n    const fundPDA = await PublicKey.findProgramAddress([walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey.toBuffer()], programId); // const fundStateAccount = await PublicKey.createWithSeed(\n    //     key,\n    //     FUND_ACCOUNT_KEY,\n    //     programId,\n    // );\n\n    let fundStateInfo = await connection.getAccountInfo(fundPDA[0]);\n    let fundState = FUND_PDA_DATA.decode(fundStateInfo.data);\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId));\n    let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey));\n    let nodeBankInfo = await connection.getAccountInfo(new PublicKey(ids.tokens[1].nodeKeys[0]));\n    let nodeBank = NodeBankLayout.decode(nodeBankInfo.data);\n    const BTCBaseLotSize = 2; // baseLotSize / quoteLotSize\n\n    console.log(\"size::::\", size / PERP_MARKETS[orderPerpIndex].contractSize);\n    const maxSlippage = 0.15; // const price = \n\n    const priceAfterSlippage = price * (1 + (side === 0 ? 1 : -1) * maxSlippage);\n    const baseUnit = Math.pow(10, PERP_MARKETS[orderPerpIndex].baseDecimals);\n    const quoteUnit = Math.pow(10, PERP_MARKETS[orderPerpIndex].quoteDecimals);\n    console.log(\"PERP_MARKETS[orderPerpIndex]:\", PERP_MARKETS[orderPerpIndex]);\n    console.log(\"maxSlippage,price,priceAfterSlippage ,baseUnit,quoteUnit ::\", maxSlippage, price, priceAfterSlippage, baseUnit, quoteUnit); // const nativePrice = new BN(priceAfterSlippage * quoteUnit)\n    //   .mul(new BN(PERP_MARKETS[orderPerpIndex].baseLotSize))\n    //   .div((new BN(PERP_MARKETS[orderPerpIndex].quoteLotSize)).mul(new BN(baseUnit)));\n\n    const nativePrice = priceAfterSlippage * quoteUnit * PERP_MARKETS[orderPerpIndex].baseLotSize / (PERP_MARKETS[orderPerpIndex].quoteLotSize * baseUnit);\n    console.log(\"nativePrice::\", nativePrice);\n    const dataLayout = struct([u8('instruction'), u8('perp_market_id'), u8('side'), nu64('price'), nu64('quantity')]);\n    const data = Buffer.alloc(dataLayout.span);\n    dataLayout.encode({\n      instruction: 10,\n      perp_market_id: orderPerpIndex,\n      side: side,\n      price: nativePrice,\n      quantity: size / PERP_MARKETS[orderPerpIndex].contractSize\n    }, data);\n    const keys = [{\n      pubkey: fundPDA[0],\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: key,\n      isSigner: true,\n      isWritable: true\n    }, {\n      pubkey: new PublicKey(ids.mangoProgramId),\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: new PublicKey(ids.publicKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: fundState.mango_positions.mango_account,\n      isSigner: false,\n      isWritable: true\n    }, // { pubkey: fundPDA[0], isSigner: false, isWritable: false },\n    {\n      pubkey: mangoGroup.mangoCache,\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].publicKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].bidsKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].asksKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].eventsKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: PublicKey.default,\n      isSigner: false,\n      isWritable: false\n    }];\n\n    for (let i = 0; i < keys.length; i++) {\n      console.log(\"key:\", i, keys[i].pubkey.toBase58());\n    }\n\n    const instruction = new TransactionInstruction({\n      keys: keys,\n      programId: programId,\n      data\n    });\n    transaction.add(instruction);\n    console.log(`transaction ::: `, transaction);\n    transaction.feePayer = key;\n    let hash = await connection.getRecentBlockhash(\"finalized\");\n    console.log(\"blockhash\", hash);\n    transaction.recentBlockhash = hash.blockhash;\n    const sign = await signAndSendTransaction(walletProvider, transaction);\n    console.log(\"tx::: \", sign);\n    console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`);\n  };\n\n  const callFromKeeper = async () => {\n    const key = walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey;\n\n    if (!key) {\n      alert(\"connect wallet\");\n      return;\n    }\n\n    ;\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId));\n    let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey));\n    const sign = await client.cacheRootBanks(new PublicKey(ids.publicKey), mangoGroup.mangoCache, [new PublicKey(MANGO_TOKENS.USDC.rootKey), new PublicKey(MANGO_TOKENS.BTC.rootKey)], walletProvider);\n  };\n\n  const handleMangoPerpDeposit = async () => {\n    const key = walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey;\n\n    if (!key) {\n      alert(\"connect wallet\");\n      return;\n    }\n\n    ;\n    const transaction = new Transaction(); // const fundStateAccount = await PublicKey.createWithSeed(\n    //     key,\n    //     FUND_ACCOUNT_KEY,\n    //     programId,\n    // );\n\n    const fundPDA = await PublicKey.findProgramAddress([walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey.toBuffer()], programId);\n    let fundStateInfo = await connection.getAccountInfo(fundPDA[0]);\n    let fundState = FUND_PDA_DATA.decode(fundStateInfo.data);\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId));\n    let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey));\n    let nodeBankInfo = await connection.getAccountInfo(new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]));\n    let nodeBank = NodeBankLayout.decode(nodeBankInfo.data);\n    console.log(\"lendAmount::::\", lendTokenIndex, lendAmount, ids.tokens[lendTokenIndex]); // console.log(\"fundStateAccount::::\",fundStateAccount.toBase58())\n\n    console.log(\"fundState.fund_pda::::\", fundState.fund_pda.toBase58());\n    console.log(\"nodeBank.vault::::\", nodeBank.vault.toBase58());\n    console.log(\"fundState.mango_positions.mango_account::::\", fundState.mango_positions.mango_account.toBase58());\n    console.log(\"mangoGroup.mangoCache::::\", mangoGroup.mangoCache.toBase58());\n    const platformDataAcc = await connection.getAccountInfo(platformStateAccount);\n\n    if (!platformDataAcc) {\n      alert('platform state not initilaized');\n      return;\n    }\n\n    const platformState = PLATFORM_DATA.decode(platformDataAcc.data); //TODO :\n    // findTokenSlotIndex ids.tokens[lendTokenIndex].mintKey\n\n    let fundTokenSlot = -1;\n    console.log(\"check for mint:\", ids.tokens[lendTokenIndex].mintKey);\n\n    for (let i = 0; i < fundState.tokens.length; i++) {\n      var _platformState$token_, _platformState$token_2;\n\n      const t = fundState.tokens[i];\n      console.log(\"i - mint:\", i, (_platformState$token_ = platformState.token_list[t.index[t.mux]]) === null || _platformState$token_ === void 0 ? void 0 : _platformState$token_.mint.toBase58());\n\n      if (((_platformState$token_2 = platformState.token_list[t.index[t.mux]]) === null || _platformState$token_2 === void 0 ? void 0 : _platformState$token_2.mint.toBase58()) == ids.tokens[lendTokenIndex].mintKey) {\n        fundTokenSlot = i;\n        console.log(\"found:\", i);\n        break;\n      }\n    }\n\n    if (fundTokenSlot == -1) {\n      alert('token not whitelisted on fund');\n      return;\n    } // findMangoTokenIndex DONE\n    //should be dynamic based on token\n\n\n    const fundVault = fundState.tokens[fundTokenSlot].vault;\n    console.log(\"fundVault::::\", fundVault.toBase58());\n    const dataLayout = struct([u8('instruction'), u8('token_slot_index'), u8('mango_token_index'), nu64('quantity')]);\n    const data = Buffer.alloc(dataLayout.span);\n    console.log(\"fundTokenSlot:\", fundTokenSlot);\n    console.log(\"MANGO_TOKENS[lendTokenIndex].mangoTokenIndex:\", MANGO_TOKENS.USDC.mangoTokenIndex);\n    dataLayout.encode({\n      instruction: 9,\n      token_slot_index: fundTokenSlot,\n      mango_token_index: MANGO_TOKENS.USDC.mangoTokenIndex,\n      quantity: lendAmount * 10 ** ids.tokens[lendTokenIndex].decimals\n    }, data);\n    const keys = [{\n      pubkey: fundState.fund_pda,\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: key,\n      isSigner: true,\n      isWritable: true\n    }, // { pubkey: fundState.fund_pda, isSigner: false, isWritable: true },\n    {\n      pubkey: new PublicKey(ids.mangoProgramId),\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: new PublicKey(ids.publicKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: fundState.mango_positions.mango_account,\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: mangoGroup.mangoCache,\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: new PublicKey(ids.tokens[lendTokenIndex].rootKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: nodeBank.vault,\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: TOKEN_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: fundVault,\n      isSigner: false,\n      isWritable: true\n    }];\n\n    for (let i = 0; i < keys.length; i++) {\n      console.log(\"key:\", i, keys[i].pubkey.toBase58());\n    }\n\n    const instruction = new TransactionInstruction({\n      keys: keys,\n      programId: programId,\n      data\n    });\n    transaction.add(instruction);\n    console.log(`transaction ::: `, transaction);\n    transaction.feePayer = key;\n    let hash = await connection.getRecentBlockhash(\"finalized\");\n    console.log(\"blockhash\", hash);\n    transaction.recentBlockhash = hash.blockhash;\n    const sign = await signAndSendTransaction(walletProvider, transaction);\n    console.log(\"tx::: \", sign);\n    console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`);\n  };\n\n  const handleMangoPerpWithdraw = async () => {\n    const key = walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey;\n\n    if (!key) {\n      alert(\"connect wallet\");\n      return;\n    }\n\n    ;\n    const fundPDA = await PublicKey.findProgramAddress([walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey.toBuffer()], programId); // const fundStateAccount = await PublicKey.createWithSeed(\n    //     key,\n    //     FUND_ACCOUNT_KEY,\n    //     programId,\n    // );\n\n    let fundStateInfo = await connection.getAccountInfo(fundPDA[0]);\n    let fundState = FUND_PDA_DATA.decode(fundStateInfo.data);\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId));\n    let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey));\n    let nodeBankInfo = await connection.getAccountInfo(new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]));\n    let nodeBank = NodeBankLayout.decode(nodeBankInfo.data);\n    const platformDataAcc = await connection.getAccountInfo(platformStateAccount);\n\n    if (!platformDataAcc) {\n      alert('platform state not initilaized');\n      return;\n    }\n\n    const platformState = PLATFORM_DATA.decode(platformDataAcc.data); //TODO :\n    // findTokenSlotIndex ids.tokens[lendTokenIndex].mintKey\n\n    let fundTokenSlot = -1;\n\n    for (let i = 0; i < fundState.tokens.length; i++) {\n      var _platformState$token_3;\n\n      if (((_platformState$token_3 = platformState.token_list[fundState.tokens[i].index[fundState.tokens[i].mux]]) === null || _platformState$token_3 === void 0 ? void 0 : _platformState$token_3.mint.toBase58()) === ids.tokens[lendTokenIndex].mintKey) {\n        fundTokenSlot = i;\n        break;\n      }\n    }\n\n    if (fundTokenSlot == -1) {\n      alert('token not whitelisted on fund');\n      return;\n    } // findMangoTokenIndex DONE\n    //should be dynamic based on token\n\n\n    const fundVault = fundState.tokens[fundTokenSlot].vault;\n    console.log(\"fundVault::::\", fundVault.toBase58());\n    const transaction = new Transaction();\n    console.log(\"fundTokenSlot:\", fundTokenSlot);\n    const dataLayout = struct([u8('instruction'), u8('token_slot_index'), u8('mango_token_index'), nu64('quantity')]);\n    const data = Buffer.alloc(dataLayout.span);\n    dataLayout.encode({\n      instruction: 13,\n      token_slot_index: fundTokenSlot,\n      mango_token_index: MANGO_TOKENS.USDC.mangoTokenIndex,\n      quantity: lendAmount * 10 ** ids.tokens[lendTokenIndex].decimals\n    }, data);\n    const keys = [{\n      pubkey: fundPDA[0],\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: key,\n      isSigner: true,\n      isWritable: true\n    }, {\n      pubkey: new PublicKey(ids.mangoProgramId),\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: new PublicKey(ids.publicKey),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: fundState.mango_positions.mango_account,\n      isSigner: false,\n      isWritable: true\n    }, // { pubkey: fundPDA[0], isSigner: false, isWritable: false },\n    {\n      pubkey: mangoGroup.mangoCache,\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: new PublicKey(ids.tokens[lendTokenIndex].rootKey),\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]),\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: nodeBank.vault,\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: fundVault,\n      isSigner: false,\n      isWritable: true\n    }, // Fund Vault\n    {\n      pubkey: mangoGroup.signerKey,\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: TOKEN_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: PublicKey.default,\n      isSigner: false,\n      isWritable: false\n    }];\n\n    for (let i = 0; i < keys.length; i++) {\n      console.log(\"key:\", i, keys[i].pubkey.toBase58());\n    }\n\n    const instruction = new TransactionInstruction({\n      keys: keys,\n      programId: programId,\n      data\n    });\n    transaction.add(instruction);\n    console.log(`transaction ::: `, transaction);\n    transaction.feePayer = key;\n    let hash = await connection.getRecentBlockhash(\"finalized\");\n    console.log(\"blockhash\", hash);\n    transaction.recentBlockhash = hash.blockhash;\n    const sign = await signAndSendTransaction(walletProvider, transaction);\n    console.log(\"tx::: \", sign);\n    console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`);\n  };\n\n  const handleConsumeEvents = async () => {\n    const key = walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey;\n\n    if (!key) {\n      alert(\"connect wallet\");\n      return;\n    }\n\n    ;\n    const fundPDA = await PublicKey.findProgramAddress([walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey.toBuffer()], programId);\n    const fundStateAccount = await PublicKey.createWithSeed(key, FUND_ACCOUNT_KEY, programId);\n    let fundStateInfo = await connection.getAccountInfo(fundStateAccount);\n    let fundState = FUND_DATA.decode(fundStateInfo.data);\n    const transaction = new Transaction();\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId));\n    let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey));\n    let perpMarketX = await client.getPerpMarket(new PublicKey(ids.perpMarkets[1].publicKey)); // client.consumeEvents(mangoGroup,perpMarketX )\n    //   const dataLayout = struct([u8('instruction'),u8('limit')])\n    //   const data = Buffer.alloc(dataLayout.span)\n    //   dataLayout.encode(\n    //       {\n    //           instruction: 15,\n    //           limit: 2,\n    //       },\n    //       data\n    //   )\n    //   const keys = [\n    //     // { pubkey: key, isSigner: true, isWritable: true },\n    //     // { pubkey: new PublicKey(ids.mangoProgramId), isSigner: false, isWritable: false },\n    //     { pubkey: new PublicKey(ids.publicKey), isSigner: false, isWritable: false },\n    //     { pubkey: mangoGroup.mangoCache, isSigner: false, isWritable: false },\n    //     { pubkey: new PublicKey(ids.perpMarkets[1].publicKey), isSigner: false, isWritable: true },\n    //     { pubkey: new PublicKey(ids.perpMarkets[1].eventsKey) , isSigner: false, isWritable: true }, \n    //     { pubkey: fundState.mango_positions.mango_account , isSigner: false, isWritable: true },\n    // ]\n    // for(let i=0; i<keys.length;i++) {\n    //   console.log(\"key:\",i, keys[i].pubkey.toBase58())\n    // }\n    //   const instruction = new TransactionInstruction({\n    //       keys: keys,\n    //       programId: programId,\n    //       data\n    //   });\n    //   transaction.add(instruction);\n    //   console.log(`transaction ::: `, transaction)\n    //   transaction.feePayer = key;\n    //   let hash = await connection.getRecentBlockhash(\"finalized\");\n    //   console.log(\"blockhash\", hash);\n    //   transaction.recentBlockhash = hash.blockhash;\n    //   const sign = await signAndSendTransaction(walletProvider, transaction);\n    //   console.log(\"tx::: \", sign)\n    //   console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`) \n  };\n\n  const handleRemovePerpMarket = async () => {\n    const perpMarketId = addRemovePerpIndex;\n    console.log(\"handleRemovePerpMarket::\", addRemovePerpIndex);\n    const key = walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey;\n\n    if (!key) {\n      alert(\"connect wallet\");\n      return;\n    }\n\n    ;\n    const fundPDA = await PublicKey.findProgramAddress([walletProvider === null || walletProvider === void 0 ? void 0 : walletProvider.publicKey.toBuffer()], programId);\n    let fundStateInfo = await connection.getAccountInfo(fundPDA[0]);\n    let fundState = FUND_PDA_DATA.decode(fundStateInfo.data);\n    console.log(\"fundState:\", fundState);\n    const transaction = new Transaction();\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId));\n    let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey));\n    const dataLayout = struct([u8('instruction'), u8('perp_market_id')]);\n    const data = Buffer.alloc(dataLayout.span);\n    dataLayout.encode({\n      instruction: 11,\n      perp_market_id: perpMarketId\n    }, data);\n    const keys = [{\n      pubkey: fundPDA[0],\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: key,\n      isSigner: true,\n      isWritable: true\n    }, {\n      pubkey: MANGO_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false\n    }, {\n      pubkey: MANGO_GROUP_ACCOUNT,\n      isSigner: false,\n      isWritable: true\n    }, {\n      pubkey: fundState.mango_positions.mango_account,\n      isSigner: false,\n      isWritable: true\n    }, // { pubkey: new PublicKey(fundsAddress), isSigner: false, isWritable: false },\n    {\n      pubkey: mangoGroup.mangoCache,\n      isSigner: false,\n      isWritable: false\n    }];\n\n    for (let i = 0; i < keys.length; i++) {\n      console.log(\"key:\", i, keys[i].pubkey.toBase58());\n    }\n\n    const instruction = new TransactionInstruction({\n      keys: keys,\n      programId: programId,\n      data\n    });\n    transaction.add(instruction);\n    console.log(`transaction ::: `, transaction);\n    transaction.feePayer = key;\n    let hash = await connection.getRecentBlockhash(\"finalized\");\n    console.log(\"blockhash\", hash);\n    transaction.recentBlockhash = hash.blockhash;\n    const sign = await signAndSendTransaction(walletProvider, transaction);\n    console.log(\"tx::: \", sign);\n    console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"form-div\",\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"LEND TOKENS\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 572,\n      columnNumber: 9\n    }, this), \"Amount :::  \", /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"number\",\n      value: lendAmount,\n      onChange: event => setLendAmount(event.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 573,\n      columnNumber: 23\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      name: \"side\",\n      width: \"100px\",\n      onChange: event => setLendTokenIndex(event.target.value),\n      children: ids.tokens.map((i, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n        value: index,\n        children: i.symbol\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 576,\n        columnNumber: 45\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 574,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleMangoPerpDeposit,\n      children: \"DEPOSIT\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 579,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleMangoPerpWithdraw,\n      children: \"WITHDRAW\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 580,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 584,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 584,\n      columnNumber: 16\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 584,\n      columnNumber: 21\n    }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"ADD/REMOVE PERP\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 585,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      name: \"side\",\n      width: \"100px\",\n      onChange: event => setAddRemovePerpIndex(event.target.value),\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        value: 0,\n        children: \"MNGO-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 587,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 1,\n        children: \"BTC-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 588,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 2,\n        children: \"ETH-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 589,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 3,\n        children: \"SOL-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 590,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 4,\n        children: \"SRM-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 591,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 5,\n        children: \"RAY-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 592,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 6,\n        children: \"FTT-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 593,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 7,\n        children: \"ADA-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 594,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 586,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleRemovePerpMarket,\n      children: \"REMOVE\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 597,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 599,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 599,\n      columnNumber: 16\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 599,\n      columnNumber: 21\n    }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Mango Place\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 601,\n      columnNumber: 13\n    }, this), \"Size ::: \", ' ', /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"number\",\n      value: size,\n      onChange: event => setSize(event.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 603,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 604,\n      columnNumber: 13\n    }, this), \"Price ::: \", ' ', /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"number\",\n      value: price,\n      onChange: event => setPrice(event.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 606,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 607,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      htmlFor: \"side\",\n      children: \"Buy/Sell\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 608,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 608,\n      columnNumber: 51\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      name: \"side\",\n      width: \"100px\",\n      onChange: event => setSide(parseInt(event.target.value)),\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        value: 0,\n        children: \"Buy\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 611,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 1,\n        children: \"Sell\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 612,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 610,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n      name: \"side\",\n      width: \"100px\",\n      onChange: event => setOrderPerpIndex(parseInt(event.target.value)),\n      children: [/*#__PURE__*/_jsxDEV(\"option\", {\n        value: 0,\n        children: \"MNGO-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 616,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 1,\n        children: \"BTC-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 617,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 2,\n        children: \"ETH-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 618,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 3,\n        children: \"SOL-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 619,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 4,\n        children: \"SRM-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 620,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 5,\n        children: \"RAY-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 621,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 6,\n        children: \"FTT-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 622,\n        columnNumber: 15\n      }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n        value: 7,\n        children: \"ADA-PERP\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 623,\n        columnNumber: 15\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 615,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handlePerpMarketOrder,\n      children: \"ORDER\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 626,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 628,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleMangoOpenOrders,\n      children: \"Open order init\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 629,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 630,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleConsumeEvents,\n      children: \" Consume Events \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 631,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: callFromKeeper,\n      children: \" KEEPER \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 633,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 636,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 570,\n    columnNumber: 9\n  }, this);\n};\n\n_s(MangoPlaceOrder, \"xB4lrE29LPK+ad2IJRzfH9vPUdA=\");\n\n_c = MangoPlaceOrder;\n\nvar _c;\n\n$RefreshReg$(_c, \"MangoPlaceOrder\");","map":{"version":3,"sources":["/Users/zohebshahzan/code/Solana-2/frontend/src/components/MangoPlaceOrder.js"],"names":["PublicKey","Transaction","TransactionInstruction","React","useState","GlobalState","adminAccount","connection","FUND_ACCOUNT_KEY","programId","TOKEN_PROGRAM_ID","MANGO_GROUP_ACCOUNT","SOL_USDC_MARKET","SYSTEM_PROGRAM_ID","idsIndex","MARGIN_ACCOUNT_KEY_1","PERP_ACCOUNT_KEY_1","MANGO_PROGRAM_ID","MANGO_TOKENS","PERP_MARKETS","platformStateAccount","nu64","struct","u8","u32","ns64","createKeyIfNotExists","findAssociatedTokenAddress","setWalletTransaction","signAndSendTransaction","createAssociatedTokenAccountIfNotExist","FUND_DATA","FUND_PDA_DATA","INVESTOR_DATA","PLATFORM_DATA","MarginAccountLayout","selfTradeBehaviorLayout","devnet_pools","pools","updatePoolPrices","mangoClosePosition","mangoOpenPosition","BN","IDS","MangoAccountLayout","MangoClient","NodeBankLayout","perpAccountLayout","PerpMarketLayout","u64","OpenOrders","MangoPlaceOrder","walletProvider","s","ids","size","setSize","price","setPrice","lendAmount","setLendAmount","orderPerpIndex","setOrderPerpIndex","addRemovePerpIndex","setAddRemovePerpIndex","addRemoveTokenIndex","setAddRemoveTokenIndex","lendTokenIndex","setLendTokenIndex","side","setSide","handleMangoOpenOrders","key","publicKey","alert","transaction","fundStateAccount","createWithSeed","console","log","toBase58","fund_info","getAccountInfo","fund_data","decode","data","pos_index","no_of_margin_positions","client","mangoProgramId","mangoGroup","getMangoGroup","openOrdersSpace","getLayout","dexProgramId","span","openOrdersLamports","getMinimumBalanceForRentExemption","accInstr","substr","toString","feePayer","hash","getRecentBlockhash","recentBlockhash","blockhash","sign","handlePerpMarketOrder","fundPDA","findProgramAddress","toBuffer","fundStateInfo","fundState","nodeBankInfo","tokens","nodeKeys","nodeBank","BTCBaseLotSize","contractSize","maxSlippage","priceAfterSlippage","baseUnit","Math","pow","baseDecimals","quoteUnit","quoteDecimals","nativePrice","baseLotSize","quoteLotSize","dataLayout","Buffer","alloc","encode","instruction","perp_market_id","quantity","keys","pubkey","isSigner","isWritable","mango_positions","mango_account","mangoCache","perpMarkets","bidsKey","asksKey","eventsKey","default","i","length","add","callFromKeeper","cacheRootBanks","USDC","rootKey","BTC","handleMangoPerpDeposit","fund_pda","vault","platformDataAcc","platformState","fundTokenSlot","mintKey","t","token_list","index","mux","mint","fundVault","mangoTokenIndex","token_slot_index","mango_token_index","decimals","handleMangoPerpWithdraw","signerKey","handleConsumeEvents","perpMarketX","getPerpMarket","handleRemovePerpMarket","perpMarketId","event","target","value","map","symbol","parseInt"],"mappings":"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","sourcesContent":["import { PublicKey, Transaction, TransactionInstruction } from '@solana/web3.js';\nimport React, { useState } from 'react'\nimport { GlobalState } from '../store/globalState';\nimport { adminAccount, connection, FUND_ACCOUNT_KEY, programId, TOKEN_PROGRAM_ID , MANGO_GROUP_ACCOUNT, SOL_USDC_MARKET, SYSTEM_PROGRAM_ID, idsIndex, MARGIN_ACCOUNT_KEY_1, PERP_ACCOUNT_KEY_1, MANGO_PROGRAM_ID, MANGO_TOKENS, PERP_MARKETS, platformStateAccount} from '../utils/constants';\nimport { nu64, struct, u8 ,u32, ns64} from 'buffer-layout';\nimport { createKeyIfNotExists, findAssociatedTokenAddress, setWalletTransaction, signAndSendTransaction, createAssociatedTokenAccountIfNotExist } from '../utils/web3';\nimport { FUND_DATA, FUND_PDA_DATA, INVESTOR_DATA, PLATFORM_DATA } from '../utils/programLayouts';\nimport { MarginAccountLayout, selfTradeBehaviorLayout } from '../utils/MangoLayout';\nimport { devnet_pools, pools } from '../utils/pools'\nimport { updatePoolPrices } from './updatePrices';\n\nimport {mangoClosePosition, mangoOpenPosition} from '../utils/mango'\nimport BN from 'bn.js';\nimport { IDS, MangoAccountLayout, MangoClient, NodeBankLayout, perpAccountLayout, PerpMarketLayout, u64 } from '@blockworks-foundation/mango-client';\nimport { OpenOrders } from '@project-serum/serum';\n\nexport const MangoPlaceOrder = () => {\n\n  const walletProvider = GlobalState.useState(s => s.walletProvider);\n\n  const ids= IDS['groups'][idsIndex];\n\n    const [size, setSize] = useState(0);\n    const [price, setPrice] = useState(0)\n    const [lendAmount, setLendAmount] = useState(0)\n    const [orderPerpIndex, setOrderPerpIndex] = useState(0);\n    const [addRemovePerpIndex, setAddRemovePerpIndex] = useState(0);\n    const [addRemoveTokenIndex, setAddRemoveTokenIndex] = useState(0);\n\n    const [lendTokenIndex, setLendTokenIndex] = useState(0)\n    const [side, setSide] = useState(0);\n    \n\n    const handleMangoOpenOrders = async () => {\n    \n      const key = walletProvider?.publicKey;\n\n    if (!key ) {\n      alert(\"connect wallet\")\n      return;\n    };\n    const transaction = new Transaction()\n\n    const fundStateAccount = await PublicKey.createWithSeed(\n      key,\n      FUND_ACCOUNT_KEY,\n      programId,\n    );\n\n    console.log(\"FUND STTE:: \", fundStateAccount.toBase58())\n    let fund_info = await connection.getAccountInfo(fundStateAccount);\n    const fund_data = FUND_DATA.decode(fund_info.data);\n\n    let pos_index = fund_data.no_of_margin_positions;\n    console.log(\"pos_index\", pos_index)\n    console.log(\"orderPerpIndex:: \", orderPerpIndex)\n  \n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId))\n    let mangoGroup = await client.getMangoGroup(connection, MANGO_GROUP_ACCOUNT)\n\n        // open orders missing for this market; create a new one now\n        const openOrdersSpace = OpenOrders.getLayout(mangoGroup.dexProgramId).span\n        const openOrdersLamports =\n          await connection.getMinimumBalanceForRentExemption(\n            openOrdersSpace,\n            'singleGossip'\n          )\n        let accInstr = await createKeyIfNotExists(\n          walletProvider,\n          \"\",\n          mangoGroup.dexProgramId,\n          key.toBase58().substr(0,20) + pos_index.toString() + orderPerpIndex.toString(),\n          openOrdersSpace,\n          transaction\n        )\n      transaction.feePayer = key;\n      let hash = await connection.getRecentBlockhash();\n      console.log(\"blockhash\", hash);\n      transaction.recentBlockhash = hash.blockhash;\n\n      const sign = await signAndSendTransaction(walletProvider, transaction);\n      console.log(\"signature tx:: \", sign)\n      console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`) \n\n     }\n\n     \n\n     const handlePerpMarketOrder = async () => {\n       console.log(\"---** handleAddPerpMarketselected orderPerpIndex, size, side :\", orderPerpIndex, size, side)\n        const key = walletProvider?.publicKey;\n        if (!key) {\n            alert(\"connect wallet\")\n            return;\n        };\n        const transaction = new Transaction()\n\n        // const perpAccount = await createKeyIfNotExists(walletProvider, \"\", MANGO_PROGRAM_ID, PERP_ACCOUNT_KEY_1, perpAccountLayout.span, transaction)\n        // console.log(\"mangoAccount created::\",perpAccount.toBase58())\n        // const mango_token_index = \n\n        const fundPDA = await PublicKey.findProgramAddress([walletProvider?.publicKey.toBuffer()], programId);\n        // const fundStateAccount = await PublicKey.createWithSeed(\n        //     key,\n        //     FUND_ACCOUNT_KEY,\n        //     programId,\n        // );\n        let fundStateInfo = await connection.getAccountInfo((fundPDA[0]))\n        let fundState = FUND_PDA_DATA.decode(fundStateInfo.data) \n    \n        let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId))\n        let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey))\n        let nodeBankInfo = await connection.getAccountInfo(new PublicKey(ids.tokens[1].nodeKeys[0]))\n        let nodeBank = NodeBankLayout.decode(nodeBankInfo.data)\n    \n        \n        const BTCBaseLotSize = 2 // baseLotSize / quoteLotSize\n        console.log(\"size::::\",size/(PERP_MARKETS[orderPerpIndex].contractSize)  )\n\n\n        const maxSlippage = 0.15;\n        // const price = \n        const priceAfterSlippage = price * (1 + (side === 0 ? 1 : -1) * maxSlippage)\n        const baseUnit = Math.pow(10, PERP_MARKETS[orderPerpIndex].baseDecimals);\n        const quoteUnit = Math.pow(10, PERP_MARKETS[orderPerpIndex].quoteDecimals);\n\n        console.log(\"PERP_MARKETS[orderPerpIndex]:\",PERP_MARKETS[orderPerpIndex])\n\n        console.log(\"maxSlippage,price,priceAfterSlippage ,baseUnit,quoteUnit ::\",maxSlippage,price,priceAfterSlippage ,baseUnit,quoteUnit)\n\n        // const nativePrice = new BN(priceAfterSlippage * quoteUnit)\n        //   .mul(new BN(PERP_MARKETS[orderPerpIndex].baseLotSize))\n        //   .div((new BN(PERP_MARKETS[orderPerpIndex].quoteLotSize)).mul(new BN(baseUnit)));\n\n        const nativePrice = (priceAfterSlippage * quoteUnit *  PERP_MARKETS[orderPerpIndex].baseLotSize )/(PERP_MARKETS[orderPerpIndex].quoteLotSize * baseUnit )\n        console.log(\"nativePrice::\",nativePrice)\n\n        const dataLayout = struct([u8('instruction'), u8('perp_market_id'), u8('side'), nu64('price'), nu64('quantity')])\n        const data = Buffer.alloc(dataLayout.span)\n        dataLayout.encode(\n            {\n                instruction: 10,\n                perp_market_id: orderPerpIndex,\n                side : side,\n                price: nativePrice,\n                quantity: size/(PERP_MARKETS[orderPerpIndex].contractSize) \n            },\n            data\n        )\n          \n        const keys = [\n          { pubkey: fundPDA[0], isSigner: false, isWritable: true },\n          { pubkey: key, isSigner: true, isWritable: true },\n         \n          { pubkey: new PublicKey(ids.mangoProgramId), isSigner: false, isWritable: false },\n          { pubkey: new PublicKey(ids.publicKey), isSigner: false, isWritable: true },\n          { pubkey: fundState.mango_positions.mango_account , isSigner: false, isWritable: true },\n         \n          // { pubkey: fundPDA[0], isSigner: false, isWritable: false },\n          { pubkey: mangoGroup.mangoCache, isSigner: false, isWritable: false },\n          \n          { pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].publicKey), isSigner: false, isWritable: true },\n          { pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].bidsKey), isSigner: false, isWritable: true },\n          { pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].asksKey) , isSigner: false, isWritable: true },\n          { pubkey: new PublicKey(ids.perpMarkets[orderPerpIndex].eventsKey) , isSigner: false, isWritable: true }, \n          \n          { pubkey: PublicKey.default, isSigner: false, isWritable: false },\n      ]\n    \n      for(let i=0; i<keys.length;i++) {\n        console.log(\"key:\",i, keys[i].pubkey.toBase58())\n      }\n        const instruction = new TransactionInstruction({\n            keys: keys,\n            programId: programId,\n            data\n        });\n    \n        transaction.add(instruction);\n        console.log(`transaction ::: `, transaction)\n        transaction.feePayer = key;\n        let hash = await connection.getRecentBlockhash(\"finalized\");\n        console.log(\"blockhash\", hash);\n        transaction.recentBlockhash = hash.blockhash;\n    \n        const sign = await signAndSendTransaction(walletProvider, transaction);\n        console.log(\"tx::: \", sign)\n        console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`) \n    \n        \n     }\n\n     const callFromKeeper = async () => {\n      const key = walletProvider?.publicKey;\n      if (!key) {\n          alert(\"connect wallet\")\n          return;\n      };\n\n      let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId))\n      let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey))\n\n\n     const sign =  await client.cacheRootBanks(new PublicKey(ids.publicKey),\n          mangoGroup.mangoCache,\n          [new PublicKey(MANGO_TOKENS.USDC.rootKey),new PublicKey(MANGO_TOKENS.BTC.rootKey)],\n          walletProvider\n       )\n     }\n\n    const handleMangoPerpDeposit = async () => {\n\n      const key = walletProvider?.publicKey;\n      if (!key) {\n          alert(\"connect wallet\")\n          return;\n      };\n      const transaction = new Transaction()\n      // const fundStateAccount = await PublicKey.createWithSeed(\n      //     key,\n      //     FUND_ACCOUNT_KEY,\n      //     programId,\n      // );\n      const fundPDA = await PublicKey.findProgramAddress([walletProvider?.publicKey.toBuffer()], programId);\n      let fundStateInfo = await connection.getAccountInfo(fundPDA[0])\n      let fundState = FUND_PDA_DATA.decode(fundStateInfo.data)\n  \n      let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId))\n      let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey))\n\n     \n      let nodeBankInfo = await connection.getAccountInfo(new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]))\n      let nodeBank = NodeBankLayout.decode(nodeBankInfo.data)\n  \n      console.log(\"lendAmount::::\",lendTokenIndex, lendAmount,ids.tokens[lendTokenIndex])\n      // console.log(\"fundStateAccount::::\",fundStateAccount.toBase58())\n      console.log(\"fundState.fund_pda::::\",fundState.fund_pda.toBase58())\n\n      console.log(\"nodeBank.vault::::\",nodeBank.vault.toBase58())\n\n      console.log(\"fundState.mango_positions.mango_account::::\",fundState.mango_positions.mango_account.toBase58())\n      console.log(\"mangoGroup.mangoCache::::\",mangoGroup.mangoCache.toBase58())\n\n     \n\n      const platformDataAcc = await connection.getAccountInfo(platformStateAccount)\n      if(!platformDataAcc){\n        alert('platform state not initilaized');\n        return;\n      }\n      const platformState = PLATFORM_DATA.decode(platformDataAcc.data)\n\n      //TODO :\n      // findTokenSlotIndex ids.tokens[lendTokenIndex].mintKey\n      let fundTokenSlot = -1;\n      console.log(\"check for mint:\",ids.tokens[lendTokenIndex].mintKey)\n      for(let i=0; i<fundState.tokens.length;i++){\n        const t = fundState.tokens[i];\n        console.log(\"i - mint:\",i,platformState.token_list[t.index[t.mux]]?.mint.toBase58())\n        if(platformState.token_list[t.index[t.mux]]?.mint.toBase58()==(ids.tokens[lendTokenIndex].mintKey)){\n          fundTokenSlot=i;\n          console.log(\"found:\",i)\n          break;\n        }\n      }\n      if(fundTokenSlot==-1){\n        alert('token not whitelisted on fund');\n        return;\n      } \n      // findMangoTokenIndex DONE\n\n       //should be dynamic based on token\n       const fundVault = fundState.tokens[fundTokenSlot].vault;\n       console.log(\"fundVault::::\",fundVault.toBase58())\n\n      const dataLayout = struct([u8('instruction'),u8('token_slot_index'), u8('mango_token_index'), nu64('quantity')])\n      const data = Buffer.alloc(dataLayout.span)\n      console.log(\"fundTokenSlot:\",fundTokenSlot)\n      console.log(\"MANGO_TOKENS[lendTokenIndex].mangoTokenIndex:\",MANGO_TOKENS.USDC.mangoTokenIndex)\n\n      dataLayout.encode(\n          {\n              instruction: 9,\n              token_slot_index: fundTokenSlot,\n              mango_token_index: MANGO_TOKENS.USDC.mangoTokenIndex,\n              quantity: lendAmount * 10 ** ids.tokens[lendTokenIndex].decimals\n          },\n          data\n      )\n\n      const keys = [\n        { pubkey: fundState.fund_pda, isSigner: false, isWritable: true },\n        { pubkey: key, isSigner: true, isWritable: true },\n        // { pubkey: fundState.fund_pda, isSigner: false, isWritable: true },\n\n        { pubkey: new PublicKey(ids.mangoProgramId), isSigner: false, isWritable: false },\n        { pubkey: new PublicKey(ids.publicKey), isSigner: false, isWritable: true },\n\n        { pubkey: fundState.mango_positions.mango_account , isSigner: false, isWritable: true },\n        { pubkey: mangoGroup.mangoCache, isSigner: false, isWritable: true },\n        { pubkey: new PublicKey(ids.tokens[lendTokenIndex].rootKey), isSigner: false, isWritable: true },\n        { pubkey: new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]), isSigner: false, isWritable: true },\n        { pubkey: nodeBank.vault, isSigner: false, isWritable: true },\n        { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },\n        { pubkey: fundVault, isSigner: false, isWritable: true },\n       ]\n    \n    for(let i=0; i<keys.length;i++) {\n      console.log(\"key:\",i, keys[i].pubkey.toBase58())\n    }\n   \n      const instruction = new TransactionInstruction({\n          keys: keys,\n          programId: programId,\n          data\n      });\n  \n      transaction.add(instruction);\n      console.log(`transaction ::: `, transaction)\n      transaction.feePayer = key;\n      let hash = await connection.getRecentBlockhash(\"finalized\");\n      console.log(\"blockhash\", hash);\n      transaction.recentBlockhash = hash.blockhash;\n  \n      const sign = await signAndSendTransaction(walletProvider, transaction);\n      console.log(\"tx::: \", sign)\n      console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`) \n\n    }\n\n   const handleMangoPerpWithdraw = async ( ) => {\n\n    const key = walletProvider?.publicKey;\n    if (!key) {\n        alert(\"connect wallet\")\n        return;\n    };\n    const fundPDA = await PublicKey.findProgramAddress([walletProvider?.publicKey.toBuffer()], programId);\n    // const fundStateAccount = await PublicKey.createWithSeed(\n    //     key,\n    //     FUND_ACCOUNT_KEY,\n    //     programId,\n    // );\n    let fundStateInfo = await connection.getAccountInfo(fundPDA[0])\n    let fundState = FUND_PDA_DATA.decode(fundStateInfo.data) \n\n    let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId))\n    let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey))\n    let nodeBankInfo = await connection.getAccountInfo(new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]))\n    let nodeBank = NodeBankLayout.decode(nodeBankInfo.data)\n\n\n    const platformDataAcc = await connection.getAccountInfo(platformStateAccount)\n    if(!platformDataAcc){\n      alert('platform state not initilaized');\n      return;\n    }\n    const platformState = PLATFORM_DATA.decode(platformDataAcc.data)\n\n    //TODO :\n    // findTokenSlotIndex ids.tokens[lendTokenIndex].mintKey\n    let fundTokenSlot = -1;\n    for(let i=0; i<fundState.tokens.length;i++){\n      if(platformState.token_list[fundState.tokens[i].index[fundState.tokens[i].mux]]?.mint.toBase58() === ids.tokens[lendTokenIndex].mintKey){\n        fundTokenSlot = i; \n        break;\n      }\n    }\n    if(fundTokenSlot==-1){\n      alert('token not whitelisted on fund');\n      return;\n    }\n    // findMangoTokenIndex DONE\n\n    //should be dynamic based on token\n      const fundVault = fundState.tokens[fundTokenSlot].vault;\n      console.log(\"fundVault::::\",fundVault.toBase58())\n\n    const transaction = new Transaction()\n    console.log(\"fundTokenSlot:\",fundTokenSlot)\n    const dataLayout = struct([u8('instruction'),u8('token_slot_index'),u8('mango_token_index'),nu64('quantity')])\n    const data = Buffer.alloc(dataLayout.span)\n    dataLayout.encode(\n        {\n            instruction: 13,\n            token_slot_index: fundTokenSlot,\n            mango_token_index: MANGO_TOKENS.USDC.mangoTokenIndex,\n            quantity: lendAmount * 10 ** ids.tokens[lendTokenIndex].decimals\n        },\n        data\n    )\n      \n    const keys = [\n      { pubkey: fundPDA[0], isSigner: false, isWritable: true },\n      { pubkey: key, isSigner: true, isWritable: true },\n      { pubkey: new PublicKey(ids.mangoProgramId), isSigner: false, isWritable: false },\n\n      { pubkey: new PublicKey(ids.publicKey), isSigner: false, isWritable: true },\n      { pubkey: fundState.mango_positions.mango_account , isSigner: false, isWritable: true },\n      // { pubkey: fundPDA[0], isSigner: false, isWritable: false },\n      { pubkey: mangoGroup.mangoCache, isSigner: false, isWritable: false },\n      { pubkey: new PublicKey(ids.tokens[lendTokenIndex].rootKey), isSigner: false, isWritable: false },\n      { pubkey: new PublicKey(ids.tokens[lendTokenIndex].nodeKeys[0]), isSigner: false, isWritable: true },\n      { pubkey: nodeBank.vault, isSigner: false, isWritable: true },\n      { pubkey: fundVault, isSigner: false, isWritable: true }, // Fund Vault\n      { pubkey: mangoGroup.signerKey, isSigner: false, isWritable: false },\n      { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },\n      { pubkey: PublicKey.default, isSigner: false, isWritable: false },\n  ]\n\n  for(let i=0; i<keys.length;i++) {\n    console.log(\"key:\",i, keys[i].pubkey.toBase58())\n  }\n    const instruction = new TransactionInstruction({\n        keys: keys,\n        programId: programId,\n        data\n    });\n\n    transaction.add(instruction);\n    console.log(`transaction ::: `, transaction)\n    transaction.feePayer = key;\n    let hash = await connection.getRecentBlockhash(\"finalized\");\n    console.log(\"blockhash\", hash);\n    transaction.recentBlockhash = hash.blockhash;\n\n    const sign = await signAndSendTransaction(walletProvider, transaction);\n    console.log(\"tx::: \", sign)\n    console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`) \n\n    }\n\n    const handleConsumeEvents = async () => {\n\n      const key = walletProvider?.publicKey;\n      if (!key) {\n          alert(\"connect wallet\")\n          return;\n      };\n\n      const fundPDA = await PublicKey.findProgramAddress([walletProvider?.publicKey.toBuffer()], programId);\n      const fundStateAccount = await PublicKey.createWithSeed(\n          key,\n          FUND_ACCOUNT_KEY,\n          programId,\n      );\n      let fundStateInfo = await connection.getAccountInfo((fundStateAccount))\n      let fundState = FUND_DATA.decode(fundStateInfo.data) \n  \n\n      const transaction = new Transaction()\n\n      let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId))\n      let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey))\n      let perpMarketX = await client.getPerpMarket(new PublicKey(ids.perpMarkets[1].publicKey))\n\n      // client.consumeEvents(mangoGroup,perpMarketX )\n    \n\n    //   const dataLayout = struct([u8('instruction'),u8('limit')])\n    //   const data = Buffer.alloc(dataLayout.span)\n    //   dataLayout.encode(\n    //       {\n    //           instruction: 15,\n    //           limit: 2,\n    //       },\n    //       data\n    //   )\n\n    //   const keys = [\n       \n    //     // { pubkey: key, isSigner: true, isWritable: true },\n    //     // { pubkey: new PublicKey(ids.mangoProgramId), isSigner: false, isWritable: false },\n    //     { pubkey: new PublicKey(ids.publicKey), isSigner: false, isWritable: false },\n    //     { pubkey: mangoGroup.mangoCache, isSigner: false, isWritable: false },\n    //     { pubkey: new PublicKey(ids.perpMarkets[1].publicKey), isSigner: false, isWritable: true },\n    //     { pubkey: new PublicKey(ids.perpMarkets[1].eventsKey) , isSigner: false, isWritable: true }, \n    //     { pubkey: fundState.mango_positions.mango_account , isSigner: false, isWritable: true },\n\n    // ]\n  \n    // for(let i=0; i<keys.length;i++) {\n    //   console.log(\"key:\",i, keys[i].pubkey.toBase58())\n    // }\n    //   const instruction = new TransactionInstruction({\n    //       keys: keys,\n    //       programId: programId,\n    //       data\n    //   });\n  \n    //   transaction.add(instruction);\n    //   console.log(`transaction ::: `, transaction)\n    //   transaction.feePayer = key;\n    //   let hash = await connection.getRecentBlockhash(\"finalized\");\n    //   console.log(\"blockhash\", hash);\n    //   transaction.recentBlockhash = hash.blockhash;\n  \n    //   const sign = await signAndSendTransaction(walletProvider, transaction);\n    //   console.log(\"tx::: \", sign)\n    //   console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`) \n    }\n\n   const handleRemovePerpMarket = async () => {\n\n\n      const perpMarketId = addRemovePerpIndex;\n      console.log(\"handleRemovePerpMarket::\",addRemovePerpIndex)\n\n      const key = walletProvider?.publicKey;\n      if (!key) {\n          alert(\"connect wallet\")\n          return;\n      };\n\n      const fundPDA = await PublicKey.findProgramAddress([walletProvider?.publicKey.toBuffer()], programId);\n      let fundStateInfo = await connection.getAccountInfo((fundPDA[0]))\n      let fundState = FUND_PDA_DATA.decode(fundStateInfo.data) \n      console.log(\"fundState:\",fundState)\n\n      const transaction = new Transaction()\n      \n      \n      let client = new MangoClient(connection, new PublicKey(ids.mangoProgramId))\n      let mangoGroup = await client.getMangoGroup(new PublicKey(ids.publicKey))\n    \n      const dataLayout = struct([u8('instruction'),u8('perp_market_id')])\n      const data = Buffer.alloc(dataLayout.span)\n      dataLayout.encode(\n          {\n              instruction: 11,\n              perp_market_id: perpMarketId\n          },\n          data\n      )\n        \n      const keys = [\n        { pubkey: fundPDA[0] , isSigner: false, isWritable: true },\n        { pubkey: key, isSigner: true, isWritable: true },\n        { pubkey: MANGO_PROGRAM_ID, isSigner: false, isWritable: false },\n        { pubkey: MANGO_GROUP_ACCOUNT, isSigner: false, isWritable: true },\n        { pubkey: fundState.mango_positions.mango_account , isSigner: false, isWritable: true },\n        // { pubkey: new PublicKey(fundsAddress), isSigner: false, isWritable: false },\n        { pubkey: mangoGroup.mangoCache, isSigner: false, isWritable: false },  \n     ]\n    \n    for(let i=0; i<keys.length;i++) {\n      console.log(\"key:\",i, keys[i].pubkey.toBase58())\n    }\n      const instruction = new TransactionInstruction({\n          keys: keys,\n          programId: programId,\n          data\n      });\n    \n      transaction.add(instruction);\n      console.log(`transaction ::: `, transaction)\n      transaction.feePayer = key;\n      let hash = await connection.getRecentBlockhash(\"finalized\");\n      console.log(\"blockhash\", hash);\n      transaction.recentBlockhash = hash.blockhash;\n  \n      const sign = await signAndSendTransaction(walletProvider, transaction);\n      console.log(\"tx::: \", sign)\n      console.log(\"signature tx url:: \", `https://solscan.io/tx/${sign}`) \n      \n    }\n\n\n    return (\n        <div className=\"form-div\">\n\n        <h4>LEND TOKENS</h4>\n          Amount :::  <input type=\"number\" value={lendAmount} onChange={(event) => setLendAmount(event.target.value)} />\n          <select name=\"side\" width = \"100px\" onChange={(event) => setLendTokenIndex(event.target.value)}>\n              {\n               ids.tokens.map( (i,index) => <option value={index}>{i.symbol}</option> )\n              }\n            </select>\n          <button onClick={handleMangoPerpDeposit}>DEPOSIT</button>\n          <button onClick={handleMangoPerpWithdraw}>WITHDRAW</button>\n\n\n\n          <br/><hr/><br/>\n          <h4>ADD/REMOVE PERP</h4>\n          <select name=\"side\" width = \"100px\" onChange={(event) => setAddRemovePerpIndex(event.target.value)}>\n              <option value={0}>MNGO-PERP</option>\n              <option value={1}>BTC-PERP</option>\n              <option value={2}>ETH-PERP</option>\n              <option value={3}>SOL-PERP</option>\n              <option value={4}>SRM-PERP</option>\n              <option value={5}>RAY-PERP</option>\n              <option value={6}>FTT-PERP</option>\n              <option value={7}>ADA-PERP</option>\n            </select>\n          {/* <button onClick={handleAddPerpMarket}>ADD</button> */}\n          <button onClick={handleRemovePerpMarket}>REMOVE</button>\n\n          <br/><hr/><br/>\n\n            <h4>Mango Place</h4> \n            Size ::: {' '}\n            <input type=\"number\" value={size} onChange={(event) => setSize(event.target.value)} />\n            <br />\n            Price ::: {' '}\n            <input type=\"number\" value={price} onChange={(event) => setPrice(event.target.value)} />\n            <br />\n            <label htmlFor=\"side\">Buy/Sell</label><br/>\n\n            <select name=\"side\" width = \"100px\" onChange={(event) => setSide(parseInt(event.target.value))}>\n              <option value={0}>Buy</option>\n              <option value={1}>Sell</option>\n            </select>\n\n            <select name=\"side\" width = \"100px\" onChange={(event) => setOrderPerpIndex(parseInt(event.target.value))}>\n              <option value={0}>MNGO-PERP</option>\n              <option value={1}>BTC-PERP</option>\n              <option value={2}>ETH-PERP</option>\n              <option value={3}>SOL-PERP</option>\n              <option value={4}>SRM-PERP</option>\n              <option value={5}>RAY-PERP</option>\n              <option value={6}>FTT-PERP</option>\n              <option value={7}>ADA-PERP</option>\n            </select>\n\n          <button onClick={handlePerpMarketOrder}>ORDER</button>\n\n          <br />\n          <button onClick={handleMangoOpenOrders}>Open order init</button>\n          <br />\n          <button onClick={handleConsumeEvents}> Consume Events </button>\n\n          <button onClick={callFromKeeper}> KEEPER </button>\n\n          \n          <br />\n        </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}