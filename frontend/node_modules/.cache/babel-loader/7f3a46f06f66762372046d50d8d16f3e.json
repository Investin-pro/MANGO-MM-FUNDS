{"ast":null,"code":"import { bits, BitStructure, Blob, Layout, seq, struct, u32, u8, u16, UInt, union } from 'buffer-layout';\nimport { PublicKey } from '@solana/web3.js';\nimport BN from 'bn.js';\nexport const NUM_TOKENS = 5;\nexport const NUM_MARKETS = NUM_TOKENS - 1;\nexport const MANGO_GROUP_PADDING = 8 - (NUM_TOKENS + NUM_MARKETS) % 8;\nexport const MAX_RATE = 3.0;\nexport const OPTIMAL_UTIL = 0.7;\nexport const OPTIMAL_RATE = 0.2;\nexport const INFO_LEN = 32;\n\nclass PublicKeyLayout extends Blob {\n  constructor(property) {\n    super(32, property);\n  }\n\n  decode(b, offset) {\n    return new PublicKey(super.decode(b, offset));\n  }\n\n  encode(src, b, offset) {\n    return super.encode(src.toBuffer(), b, offset);\n  }\n\n}\n\nexport function publicKeyLayout() {\n  let property = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return new PublicKeyLayout(property);\n}\n\nclass BNLayout extends Blob {\n  constructor(number, property) {\n    super(number, property); // restore prototype chain\n\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  decode(b, offset) {\n    return new BN(super.decode(b, offset), 10, 'le');\n  }\n\n  encode(src, b, offset) {\n    return super.encode(src.toArrayLike(Buffer, 'le', this['span']), b, offset);\n  }\n\n}\n\nexport function u64() {\n  let property = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return new BNLayout(8, property);\n}\nexport function u128() {\n  let property = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return new BNLayout(16, property);\n}\n\nclass U64F64Layout extends Blob {\n  constructor(property) {\n    super(16, property);\n  }\n\n  decode(b, offset) {\n    const raw = new BN(super.decode(b, offset), 10, 'le'); // @ts-ignore\n\n    return raw / Math.pow(2, 64);\n  }\n\n  encode(src, b, offset) {\n    return super.encode(src.toArrayLike(Buffer, 'le', this['span']), b, offset);\n  }\n\n}\n\nexport function U64F64() {\n  let property = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return new U64F64Layout(property);\n}\n_c = U64F64;\nexport class WideBits extends Layout {\n  constructor(property) {\n    super(8, property);\n    this._lower = bits(u32(), false);\n    this._upper = bits(u32(), false);\n  }\n\n  addBoolean(property) {\n    if (this._lower.fields.length < 32) {\n      this._lower.addBoolean(property);\n    } else {\n      this._upper.addBoolean(property);\n    }\n  }\n\n  decode(b) {\n    let offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n    const lowerDecoded = this._lower.decode(b, offset);\n\n    const upperDecoded = this._upper.decode(b, offset + this._lower.span);\n\n    return { ...lowerDecoded,\n      ...upperDecoded\n    };\n  }\n\n  replicate(property) {\n    return super.replicate(property);\n  }\n\n  encode(src, b) {\n    let offset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    return this._lower.encode(src, b, offset) + this._upper.encode(src, b, offset + this._lower.span);\n  }\n\n}\nconst ACCOUNT_FLAGS_LAYOUT = new WideBits(undefined);\nACCOUNT_FLAGS_LAYOUT.addBoolean('Initialized');\nACCOUNT_FLAGS_LAYOUT.addBoolean('MangoGroup');\nACCOUNT_FLAGS_LAYOUT.addBoolean('MarginAccount');\nACCOUNT_FLAGS_LAYOUT.addBoolean('MangoSrmAccount');\nexport function accountFlagsLayout() {\n  let property = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'accountFlags';\n  return ACCOUNT_FLAGS_LAYOUT.replicate(property); // TODO: when ts check is on, replicate throws error, doesn't compile\n}\nexport const MangoIndexLayout = struct([u64('lastUpdate'), U64F64('borrow'), // U64F64\nU64F64('deposit') // U64F64\n]);\nexport const MangoGroupLayout = struct([accountFlagsLayout('accountFlags'), seq(publicKeyLayout(), NUM_TOKENS, 'tokens'), seq(publicKeyLayout(), NUM_TOKENS, 'vaults'), seq(MangoIndexLayout.replicate(), NUM_TOKENS, 'indexes'), seq(publicKeyLayout(), NUM_MARKETS, 'spotMarkets'), seq(publicKeyLayout(), NUM_MARKETS, 'oracles'), u64('signerNonce'), publicKeyLayout('signerKey'), publicKeyLayout('dexProgramId'), seq(U64F64(), NUM_TOKENS, 'totalDeposits'), seq(U64F64(), NUM_TOKENS, 'totalBorrows'), U64F64('maintCollRatio'), U64F64('initCollRatio'), publicKeyLayout('srmVault'), publicKeyLayout('admin'), seq(u64(), NUM_TOKENS, 'borrowLimits'), seq(u8(), NUM_TOKENS, 'mintDecimals'), seq(u8(), NUM_MARKETS, 'oracleDecimals'), seq(u8(), MANGO_GROUP_PADDING, 'padding')]);\nexport const MarginAccountLayout = struct([accountFlagsLayout('accountFlags'), publicKeyLayout('mangoGroup'), publicKeyLayout('owner'), seq(U64F64(), NUM_TOKENS, 'deposits'), seq(U64F64(), NUM_TOKENS, 'borrows'), seq(publicKeyLayout(), NUM_MARKETS, 'openOrders'), u8('beingLiquidated'), u8('hasBorrows'), seq(u8(), 32, 'info'), seq(u8(), 38, 'padding')]);\nexport const MangoSrmAccountLayout = struct([accountFlagsLayout('accountFlags'), publicKeyLayout('mangoGroup'), publicKeyLayout('owner'), u64('amount')]);\nexport const AccountLayout = struct([publicKeyLayout('mint'), publicKeyLayout('owner'), u64('amount'), u32('delegateOption'), publicKeyLayout('delegate'), u8('state'), u32('isNativeOption'), u64('isNative'), u64('delegatedAmount'), u32('closeAuthorityOption'), publicKeyLayout('closeAuthority')]);\n\nclass EnumLayout extends UInt {\n  constructor(values, span, property) {\n    super(span, property);\n    this.values = values;\n  }\n\n  encode(src, b, offset) {\n    if (this.values[src] !== undefined) {\n      return super.encode(this.values[src], b, offset);\n    }\n\n    throw new Error('Invalid ' + this['property']);\n  }\n\n  decode(b, offset) {\n    const decodedValue = super.decode(b, offset);\n    const entry = Object.entries(this.values).find(_ref => {\n      let [, value] = _ref;\n      return value === decodedValue;\n    });\n\n    if (entry) {\n      return entry[0];\n    }\n\n    throw new Error('Invalid ' + this['property']);\n  }\n\n}\n\nexport function sideLayout(property) {\n  return new EnumLayout({\n    buy: 0,\n    sell: 1\n  }, 4, property);\n}\nexport function orderTypeLayout(property) {\n  return new EnumLayout({\n    limit: 0,\n    ioc: 1,\n    postOnly: 2\n  }, 4, property);\n}\nexport function selfTradeBehaviorLayout(property) {\n  return new EnumLayout({\n    decrementTake: 0,\n    cancelProvide: 1,\n    abortTransaction: 2\n  }, 4, property);\n}\nexport const MangoInstructionLayout = union(u32('instruction'));\nMangoInstructionLayout.addVariant(0, struct([]), 'InitMangoGroup'); // TODO this is unimplemented\n\nMangoInstructionLayout.addVariant(1, struct([]), 'InitMarginAccount');\nMangoInstructionLayout.addVariant(2, struct([u64('quantity')]), 'Deposit');\nMangoInstructionLayout.addVariant(3, struct([u64('quantity')]), 'Withdraw');\nMangoInstructionLayout.addVariant(4, struct([u64('tokenIndex'), u64('quantity')]), 'Borrow');\nMangoInstructionLayout.addVariant(5, struct([u64('tokenIndex'), u64('quantity')]), 'SettleBorrow');\nMangoInstructionLayout.addVariant(6, struct([seq(u64(), NUM_TOKENS, 'depositQuantities')]), 'Liquidate');\nMangoInstructionLayout.addVariant(7, struct([u64('quantity')]), 'DepositSrm');\nMangoInstructionLayout.addVariant(8, struct([u64('quantity')]), 'WithdrawSrm');\nMangoInstructionLayout.addVariant(9, struct([sideLayout('side'), u64('limitPrice'), u64('maxBaseQuantity'), u64('maxQuoteQuantity'), selfTradeBehaviorLayout('selfTradeBehavior'), orderTypeLayout('orderType'), u64('clientId'), u16('limit')]), 'PlaceOrder');\nMangoInstructionLayout.addVariant(10, struct([]), 'SettleFunds');\nMangoInstructionLayout.addVariant(11, struct([sideLayout('side'), u128('orderId')]), 'CancelOrder');\nMangoInstructionLayout.addVariant(12, struct([u64('clientId')]), 'CancelOrderByClientId');\nMangoInstructionLayout.addVariant(13, struct([u64('tokenIndex'), u64('borrowLimit')]), 'ChangeBorrowLimit');\nMangoInstructionLayout.addVariant(14, struct([sideLayout('side'), u64('limitPrice'), u64('maxBaseQuantity'), u64('maxQuoteQuantity'), selfTradeBehaviorLayout('selfTradeBehavior'), orderTypeLayout('orderType'), u64('clientId'), u16('limit')]), 'PlaceAndSettle');\nMangoInstructionLayout.addVariant(15, struct([u8('limit')]), 'ForceCancelOrders');\nMangoInstructionLayout.addVariant(16, struct([u64('maxDeposit')]), 'PartialLiquidate');\nMangoInstructionLayout.addVariant(17, struct([seq(u8(), INFO_LEN, 'info')]), 'AddMarginAccountInfo'); // @ts-ignore\n\nconst instructionMaxSpan = Math.max(...Object.values(MangoInstructionLayout.registry).map(r => r.span));\nexport function encodeMangoInstruction(data) {\n  const b = Buffer.alloc(instructionMaxSpan);\n  const span = MangoInstructionLayout.encode(data, b);\n  return b.slice(0, span);\n}\n\nvar _c;\n\n$RefreshReg$(_c, \"U64F64\");","map":{"version":3,"sources":["/Users/zohebshahzan/code/Solana-2/frontend/src/utils/MangoLayout.js"],"names":["bits","BitStructure","Blob","Layout","seq","struct","u32","u8","u16","UInt","union","PublicKey","BN","NUM_TOKENS","NUM_MARKETS","MANGO_GROUP_PADDING","MAX_RATE","OPTIMAL_UTIL","OPTIMAL_RATE","INFO_LEN","PublicKeyLayout","constructor","property","decode","b","offset","encode","src","toBuffer","publicKeyLayout","BNLayout","number","Object","setPrototypeOf","new","target","prototype","toArrayLike","Buffer","u64","u128","U64F64Layout","raw","Math","pow","U64F64","WideBits","_lower","_upper","addBoolean","fields","length","lowerDecoded","upperDecoded","span","replicate","ACCOUNT_FLAGS_LAYOUT","undefined","accountFlagsLayout","MangoIndexLayout","MangoGroupLayout","MarginAccountLayout","MangoSrmAccountLayout","AccountLayout","EnumLayout","values","Error","decodedValue","entry","entries","find","value","sideLayout","buy","sell","orderTypeLayout","limit","ioc","postOnly","selfTradeBehaviorLayout","decrementTake","cancelProvide","abortTransaction","MangoInstructionLayout","addVariant","instructionMaxSpan","max","registry","map","r","encodeMangoInstruction","data","alloc","slice"],"mappings":"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","sourcesContent":["import { bits, BitStructure, Blob, Layout, seq, struct, u32, u8, u16, UInt, union } from 'buffer-layout';\nimport { PublicKey } from '@solana/web3.js';\nimport BN from 'bn.js';\n\nexport const NUM_TOKENS = 5;\nexport const NUM_MARKETS = NUM_TOKENS - 1;\nexport const MANGO_GROUP_PADDING = 8 - (NUM_TOKENS + NUM_MARKETS) % 8;\nexport const MAX_RATE = 3.0\nexport const OPTIMAL_UTIL = 0.7\nexport const OPTIMAL_RATE = 0.2\nexport const INFO_LEN = 32\n\nclass PublicKeyLayout extends Blob {\n  constructor(property) {\n    super(32, property);\n  }\n\n  decode(b, offset) {\n    return new PublicKey(super.decode(b, offset));\n  }\n\n  encode(src, b, offset) {\n    return super.encode(src.toBuffer(), b, offset);\n  }\n}\n\nexport function publicKeyLayout(property = \"\") {\n  return new PublicKeyLayout(property);\n}\n\nclass BNLayout extends Blob {\n  constructor(number, property) {\n    super(number, property);\n    // restore prototype chain\n    Object.setPrototypeOf(this, new.target.prototype)\n  }\n\n  decode(b, offset) {\n    return new BN(super.decode(b, offset), 10, 'le');\n  }\n\n  encode(src, b, offset) {\n    return super.encode(src.toArrayLike(Buffer, 'le', this['span']), b, offset);\n  }\n}\n\nexport function u64(property = \"\") {\n  return new BNLayout(8, property);\n}\n\nexport function u128(property = \"\") {\n  return new BNLayout(16, property);\n}\n\n\nclass U64F64Layout extends Blob {\n  constructor(property) {\n    super(16, property);\n  }\n\n  decode(b, offset) {\n    const raw = new BN(super.decode(b, offset), 10, 'le');\n\n    // @ts-ignore\n    return raw / Math.pow(2, 64);\n  }\n\n  encode(src, b, offset) {\n    return super.encode(src.toArrayLike(Buffer, 'le', this['span']), b, offset);\n  }\n}\n\nexport function U64F64(property = \"\") {\n  return new U64F64Layout(property)\n}\n\nexport class WideBits extends Layout {\n  _lower;\n  _upper;\n\n  constructor(property) {\n    super(8, property);\n    this._lower = bits(u32(), false);\n    this._upper = bits(u32(), false);\n  }\n\n  addBoolean(property) {\n    if (this._lower.fields.length < 32) {\n      this._lower.addBoolean(property);\n    } else {\n      this._upper.addBoolean(property);\n    }\n  }\n\n  decode(b, offset = 0) {\n    const lowerDecoded = this._lower.decode(b, offset);\n    const upperDecoded = this._upper.decode(b, offset + this._lower.span);\n    return { ...lowerDecoded, ...upperDecoded };\n  }\n\n  replicate(property) {\n    return super.replicate(property);\n  }\n  encode(src, b, offset = 0) {\n    return (\n      this._lower.encode(src, b, offset) +\n      this._upper.encode(src, b, offset + this._lower.span)\n    );\n  }\n}\nconst ACCOUNT_FLAGS_LAYOUT = new WideBits(undefined);\nACCOUNT_FLAGS_LAYOUT.addBoolean('Initialized');\nACCOUNT_FLAGS_LAYOUT.addBoolean('MangoGroup');\nACCOUNT_FLAGS_LAYOUT.addBoolean('MarginAccount');\nACCOUNT_FLAGS_LAYOUT.addBoolean('MangoSrmAccount');\n\nexport function accountFlagsLayout(property = 'accountFlags') {\n  return ACCOUNT_FLAGS_LAYOUT.replicate(property);  // TODO: when ts check is on, replicate throws error, doesn't compile\n}\n\nexport const MangoIndexLayout = struct([\n  u64('lastUpdate'),\n  U64F64('borrow'), // U64F64\n  U64F64('deposit')  // U64F64\n]);\n\nexport const MangoGroupLayout = struct([\n  accountFlagsLayout('accountFlags'),\n  seq(publicKeyLayout(), NUM_TOKENS, 'tokens'),\n  seq(publicKeyLayout(), NUM_TOKENS, 'vaults'),\n  seq(MangoIndexLayout.replicate(), NUM_TOKENS, 'indexes'),\n  seq(publicKeyLayout(), NUM_MARKETS, 'spotMarkets'),\n  seq(publicKeyLayout(), NUM_MARKETS, 'oracles'),\n\n  u64('signerNonce'),\n  publicKeyLayout('signerKey'),\n  publicKeyLayout('dexProgramId'),\n  seq(U64F64(), NUM_TOKENS, 'totalDeposits'),\n  seq(U64F64(), NUM_TOKENS, 'totalBorrows'),\n  U64F64('maintCollRatio'),\n  U64F64('initCollRatio'),\n  publicKeyLayout('srmVault'),\n  publicKeyLayout('admin'),\n  seq(u64(), NUM_TOKENS, 'borrowLimits'),\n  seq(u8(), NUM_TOKENS, 'mintDecimals'),\n  seq(u8(), NUM_MARKETS, 'oracleDecimals'),\n  seq(u8(), MANGO_GROUP_PADDING, 'padding')\n]);\n\n\nexport const MarginAccountLayout = struct([\n  accountFlagsLayout('accountFlags'),\n  publicKeyLayout('mangoGroup'),\n  publicKeyLayout('owner'),\n\n  seq(U64F64(), NUM_TOKENS, 'deposits'),\n  seq(U64F64(), NUM_TOKENS, 'borrows'),\n  seq(publicKeyLayout(), NUM_MARKETS, 'openOrders'),\n  u8('beingLiquidated'),\n  u8('hasBorrows'),\n  seq(u8(), 32, 'info'),\n  seq(u8(), 38, 'padding')\n]);\n\nexport const MangoSrmAccountLayout = struct([\n  accountFlagsLayout('accountFlags'),\n  publicKeyLayout('mangoGroup'),\n  publicKeyLayout('owner'),\n  u64('amount')\n]);\n\nexport const AccountLayout = struct([\n  publicKeyLayout('mint'),\n  publicKeyLayout('owner'),\n  u64('amount'),\n  u32('delegateOption'),\n  publicKeyLayout('delegate'),\n  u8('state'),\n  u32('isNativeOption'),\n  u64('isNative'),\n  u64('delegatedAmount'),\n  u32('closeAuthorityOption'),\n  publicKeyLayout('closeAuthority')\n]);\n\nclass EnumLayout extends UInt {\n  values;\n  constructor(values, span, property) {\n    super(span, property);\n    this.values = values\n  }\n  encode(src, b, offset) {\n    if (this.values[src] !== undefined) {\n      return super.encode(this.values[src], b, offset);\n    }\n    throw new Error('Invalid ' + this['property']);\n  }\n\n  decode(b, offset) {\n    const decodedValue = super.decode(b, offset);\n    const entry = Object.entries(this.values).find(\n      ([, value]) => value === decodedValue,\n    );\n    if (entry) {\n      return entry[0];\n    }\n    throw new Error('Invalid ' + this['property']);\n  }\n}\n\nexport function sideLayout(property) {\n  return new EnumLayout({ buy: 0, sell: 1 }, 4, property);\n}\n\nexport function orderTypeLayout(property) {\n  return new EnumLayout({ limit: 0, ioc: 1, postOnly: 2 }, 4, property);\n}\n\nexport function selfTradeBehaviorLayout(property) {\n  return new EnumLayout({ decrementTake: 0, cancelProvide: 1, abortTransaction: 2 }, 4, property);\n}\n\nexport const MangoInstructionLayout = union(u32('instruction'))\n\nMangoInstructionLayout.addVariant(0, struct([]), 'InitMangoGroup')  // TODO this is unimplemented\n\nMangoInstructionLayout.addVariant(1, struct([]), 'InitMarginAccount')\nMangoInstructionLayout.addVariant(2, struct([u64('quantity')]), 'Deposit')\nMangoInstructionLayout.addVariant(3, struct([u64('quantity')]), 'Withdraw')\nMangoInstructionLayout.addVariant(4, struct([u64('tokenIndex'), u64('quantity')]), 'Borrow')\nMangoInstructionLayout.addVariant(5, struct([u64('tokenIndex'), u64('quantity')]), 'SettleBorrow')\nMangoInstructionLayout.addVariant(6, struct([seq(u64(), NUM_TOKENS, 'depositQuantities')]), 'Liquidate')\nMangoInstructionLayout.addVariant(7, struct([u64('quantity')]), 'DepositSrm')\nMangoInstructionLayout.addVariant(8, struct([u64('quantity')]), 'WithdrawSrm')\n\nMangoInstructionLayout.addVariant(9,\n  struct(\n    [\n      sideLayout('side'),\n      u64('limitPrice'),\n      u64('maxBaseQuantity'),\n      u64('maxQuoteQuantity'),\n      selfTradeBehaviorLayout('selfTradeBehavior'),\n      orderTypeLayout('orderType'),\n      u64('clientId'),\n      u16('limit'),\n    ]\n  ),\n  'PlaceOrder'\n)\n\nMangoInstructionLayout.addVariant(10, struct([]), 'SettleFunds')\nMangoInstructionLayout.addVariant(11,\n  struct(\n    [\n      sideLayout('side'),\n      u128('orderId')\n    ]\n  ),\n  'CancelOrder'\n)\n\nMangoInstructionLayout.addVariant(12, struct([u64('clientId')]), 'CancelOrderByClientId')\nMangoInstructionLayout.addVariant(13, struct([u64('tokenIndex'), u64('borrowLimit')]), 'ChangeBorrowLimit')\nMangoInstructionLayout.addVariant(14,\n  struct(\n    [\n      sideLayout('side'),\n      u64('limitPrice'),\n      u64('maxBaseQuantity'),\n      u64('maxQuoteQuantity'),\n      selfTradeBehaviorLayout('selfTradeBehavior'),\n      orderTypeLayout('orderType'),\n      u64('clientId'),\n      u16('limit'),\n    ]\n  ),\n  'PlaceAndSettle'\n)\nMangoInstructionLayout.addVariant(15, struct([u8('limit')]), 'ForceCancelOrders')\nMangoInstructionLayout.addVariant(16, struct([u64('maxDeposit')]), 'PartialLiquidate')\nMangoInstructionLayout.addVariant(17, struct([seq(u8(), INFO_LEN, 'info')]), 'AddMarginAccountInfo')\n// @ts-ignore\nconst instructionMaxSpan = Math.max(...Object.values(MangoInstructionLayout.registry).map((r) => r.span));\nexport function encodeMangoInstruction(data) {\n  const b = Buffer.alloc(instructionMaxSpan);\n  const span = MangoInstructionLayout.encode(data, b);\n  return b.slice(0, span);\n}"]},"metadata":{},"sourceType":"module"}